name: Frontend Tests

on:
  workflow_call:
    outputs:
      coverage-artifact:
        description: "Frontend coverage artifact name"
        value: ${{ jobs.test.outputs.coverage-artifact }}

jobs:
  test:
    name: Frontend Build + Lint
    runs-on: ubuntu-latest
    outputs:
      coverage-artifact: frontend-coverage

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Set up Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '22'
        cache: 'npm'
        cache-dependency-path: webapp/package-lock.json

    - name: Install dependencies
      run: |
        cd webapp
        npm ci --no-audit --no-fund --no-progress

    - name: Run TypeScript check
      run: |
        cd webapp
        npx vue-tsc -b

    - name: Run i18n check
      run: |
        cd webapp
        npm run lint:i18n

    - name: Build frontend
      run: |
        cd webapp
        npm run build

    - name: Run unit tests with coverage
      run: |
        cd webapp
        npm run test:coverage

    - name: Upload frontend coverage artifact
      uses: actions/upload-artifact@v4
      with:
        name: frontend-coverage
        path: webapp/coverage/lcov.info
        retention-days: 1
